{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="fw-bold">{{ "Edit Order" if order else "Add Order" }}</h4>
    <a href="{{ url_for('orders') }}" class="btn btn-secondary btn-sm">← Back</a>
</div>

<form method="post" class="row g-3 needs-validation" novalidate>
  <div class="col-md-2">
    <label class="form-label">Date</label>
    <input type="date" name="date" class="form-control" required>
    <div class="invalid-feedback">Select date</div>
  </div>

  <div class="col-md-4">
    <label class="form-label">Customer</label>
    <!-- recent-first comes from the view; keep this select -->
    <select name="customer_id" class="form-select" required>
      <option value="">-- Select Customer --</option>
      {% for c in customers_recent_first %}
        <option value="{{ c.customer_id }}">{{ c.customer_id }} — {{ c.name }}</option>
      {% endfor %}
    </select>
    <div class="invalid-feedback">Choose a customer</div>
  </div>

  <div class="col-md-3">
    <label class="form-label">Saree Type</label>
    <input name="saree_type" class="form-control" placeholder="e.g., Banarasi" required>
    <div class="invalid-feedback">Enter saree type</div>
  </div>

  <div class="col-md-3">
    <label class="form-label">Amount (₹)</label>
    <input name="amount" inputmode="numeric" class="form-control" required>
    <div class="invalid-feedback">Enter amount</div>
  </div>

  <div class="col-md-3">
    <label class="form-label">Purchase Type</label>
    <select name="purchase_type" class="form-select" required>
      <option value="">-- Select Purchase Type --</option>
      <option>Online</option>
      <option>Offline</option>
    </select>
    <div class="invalid-feedback">Pick purchase type</div>
  </div>

  <div class="col-md-3">
    <label class="form-label">Payment Status</label>
    <select id="payment_status" name="payment_status" class="form-select" required>
      <option value="">-- Select Payment Status --</option>
      <option value="Pending">Pending</option>
      <option value="Paid">Paid</option>
    </select>
    <div class="invalid-feedback">Pick payment status</div>
  </div>

  <div class="col-md-3">
    <label class="form-label">Payment Mode</label>
    <select id="payment_mode" name="payment_mode" class="form-select">
      <option value="">-- Select Payment Mode --</option>
      <option value="UPI">UPI</option>
      <option value="Cash">Cash</option>
      <option value="Pending">Pending</option>
    </select>
  </div>

  <div class="col-md-3">
    <label class="form-label">Delivery Status</label>
    <select name="delivery_status" class="form-select" required>
      <option value="">-- Select Delivery Status --</option>
      <option>Pending</option>
      <option>Shipped</option>
      <option>Delivered</option>
      <option>Cancelled</option>
    </select>
    <div class="invalid-feedback">Pick delivery status</div>
  </div>

  <div class="col-12">
    <label class="form-label">Remarks</label>
    <input name="remarks" class="form-control" placeholder="Optional">
  </div>

  <div class="col-12">
    <button class="btn btn-primary">Save</button>
    <a href="{{ url_for('orders') }}" class="btn btn-outline-secondary">Cancel</a>
  </div>
</form>

<script>
// Bootstrap client-side validation
(function() {
  const forms = document.querySelectorAll('.needs-validation');
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', e => {
      if (!form.checkValidity()) {
        e.preventDefault();
        e.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
})();

// Auto-toggle Payment Mode based on Status
(function(){
  const st = document.getElementById('payment_status');
  const mode = document.getElementById('payment_mode');
  if (!st || !mode) return;

  function toggleMode() {
    if (st.value === 'Pending' || st.value === '') {
      mode.value = 'Pending';
      mode.disabled = true;
    } else {
      if (mode.value === 'Pending') mode.value = '';
      mode.disabled = false;
    }
  }
  st.addEventListener('change', toggleMode);
  window.addEventListener('load', toggleMode);
})();
</script>

{% endblock %}

